<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.winter.mapper.PerformanceMapper">
    <!--查询全部数据-->
    <select id="findAll" resultType="com.winter.domain.Performance">
        select * from performance
    </select>

    <!--新插入一条数据-->
    <insert id="add" parameterType="com.winter.domain.Performance">
        insert into performance(id, hostname, timestamp, step, cpu_usage, mem_usage)
        values(#{id}, #{hostname}, #{timestamp}, #{step}, #{cpu_usage}, #{mem_usage})
    </insert>

    <!--条件查询语句，查询指定机器，指定范围的数据-->
    <select id="findByCondition" parameterType="com.winter.req.QueryPerformanceReq">
        select
            <choose>
                <when test="metric == null">
                    cpu_usage, mem_usage
                </when>
                <when test="metric == 'cpu.used.percent'">
                    cpu_usage
                </when>
                <when test="metric == 'mem.used.percent'">
                    mem_usage
                </when>
            </choose>
        from performance
            <where>
                <if test="endpoint != null">and hostname = #{endpoint}</if>
                <if test="start_ts != null">and start_ts &gt; #{start_ts}</if>
                <if test="end_ts != null">and end_ts &lt; #{end_ts}</if>
            </where>
    </select>
</mapper>